<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>๐ ูุชุฌุฑู</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>๐ูุชุฌุฑ ุณูุฑูุงูุง ูุงุฑูุช</h1>
  <button onclick="promptAdmin()">ููุญุฉ ุงูุชุญูู</button>
  <span id="cart-count">0</span>
</header>

<section id="admin" class="admin hidden">
  <h2>ููุญุฉ ุงูุชุญูู</h2>
  <input id="name" placeholder="ุงุณู ุงูููุชุฌ">
  <input id="price" type="number" placeholder="ุงูุณุนุฑ">
  <input id="img" placeholder="ุฑุงุจุท ุงูุตูุฑุฉ">
  <button onclick="addProduct()">ุฅุถุงูุฉ ุงูููุชุฌ</button>

  <h3>ูุงุฆูุฉ ุงูููุชุฌุงุช</h3>
  <ul id="admin-products"></ul>
</section>

<main>
  <section id="products" class="products"></section>

  <aside class="cart">
    <h2>ุณูุฉ ุงูุดุฑุงุก</h2>
    <ul id="cart-items"></ul>
    <p id="total">ุงููุฌููุน: 0$</p>
    <a id="whatsapp" target="_blank">ุงุทูุจ ุนุจุฑ ูุงุชุณุงุจ</a>
  </aside>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

// ุฅุนุฏุงุฏ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyD0uhGhSsbNBL0VogBFPORXsbgqippZFBo",
  authDomain: "syriana-markt-10.firebaseapp.com",
  projectId: "syriana-markt-10",
  storageBucket: "syriana-markt-10.firebasestorage.app",
  messagingSenderId: "165199547512",
  appId: "1:165199547512:web:e6124bdbfa4cfe4739f18d",
  measurementId: "G-3ZSYK17CPE"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ุนูุงุตุฑ DOM
const productsDiv = document.getElementById("products");
const cartItems = document.getElementById("cart-items");
const totalText = document.getElementById("total");
const cartCount = document.getElementById("cart-count");
const whatsappBtn = document.getElementById("whatsapp");
const adminProducts = document.getElementById("admin-products");

// ุงูุณูุฉ
let cart = [];

// ูููุฉ ูุฑูุฑ ุงูุฃุฏูู
const adminPassword = "1234";

// ููุญุฉ ุงูุชุญูู
function promptAdmin() {
  const pass = prompt("ุฃุฏุฎู ูููุฉ ูุฑูุฑ ุงูุฃุฏูู:");
  if (pass === adminPassword) {
    document.getElementById("admin").classList.toggle("hidden");
    renderAdminProducts();
  } else {
    alert("ูููุฉ ุงููุฑูุฑ ุฎุงุทุฆุฉ!");
  }
}

// ุฅุถุงูุฉ ููุชุฌ
async function addProduct() {
  const name = document.getElementById("name").value;
  const price = Number(document.getElementById("price").value);
  const img = document.getElementById("img").value;

  if (!name || !price || !img) { alert("ุนุจู ูู ุงูุญููู"); return; }

  await addDoc(collection(db, "products"), { name, price, img });
  document.getElementById("name").value = "";
  document.getElementById("price").value = "";
  document.getElementById("img").value = "";
}

// ุญุฐู ููุชุฌ
async function deleteProduct(id) {
  await deleteDoc(doc(db, "products", id));
}

// ุชุนุฏูู ููุชุฌ
async function editProduct(id, current) {
  const newName = prompt("ุงูุงุณู ุงูุฌุฏูุฏ:", current.name);
  const newPrice = prompt("ุงูุณุนุฑ ุงูุฌุฏูุฏ:", current.price);
  const newImg = prompt("ุฑุงุจุท ุงูุตูุฑุฉ ุงูุฌุฏูุฏ:", current.img);
  if(newName && newPrice && newImg){
    await updateDoc(doc(db,"products",id), { name: newName, price: Number(newPrice), img: newImg });
  }
}

// ุนุฑุถ ุงูููุชุฌุงุช ูู ููุญุฉ ุงูุชุญูู
function renderAdminProducts() {
  onSnapshot(collection(db,"products"), (snapshot)=>{
    adminProducts.innerHTML = "";
    snapshot.forEach(docSnap => {
      const p = docSnap.data();
      adminProducts.innerHTML += `<li>${p.name} - ${p.price}$
        <button class="edit" onclick='editProduct("${docSnap.id}", ${JSON.stringify(p)})'>ุชุนุฏูู</button>
        <button class="delete" onclick='deleteProduct("${docSnap.id}")'>ุญุฐู</button>
      </li>`;
    });
  });
}

// ุนุฑุถ ุงูููุชุฌุงุช ุงูุนุงูุฉ
function renderProducts() {
  onSnapshot(collection(db,"products"), (snapshot)=>{
    productsDiv.innerHTML = "";
    snapshot.forEach((docSnap, index) => {
      const p = docSnap.data();
      productsDiv.innerHTML += `
        <div class="product">
          <img src="${p.img}">
          <h3>${p.name}</h3>
          <p>${p.price}$</p>
          <input type="number" value="1" min="1" id="qty-${index}" onchange="updateCartQty(${index})">
          <button onclick="addToCart(${index}, ${JSON.stringify(p)})">ุฃุถู ููุณูุฉ</button>
        </div>
      `;
    });
  });
}

// ุณูุฉ ุงูุดุฑุงุก
function addToCart(index, item) {
  const qty = Number(document.getElementById(`qty-${index}`).value) || 1;
  cart.push({ ...item, qty });
  renderCart();
}

function updateCartQty(index) {
  const qty = Number(document.getElementById(`qty-${index}`).value) || 1;
  if(cart[index]) cart[index].qty = qty;
  renderCart();
}

function removeFromCart(index) {
  cart.splice(index,1);
  renderCart();
}

function renderCart() {
  cartItems.innerHTML = "";
  let total = 0;
  cart.forEach((item,i)=>{
    total += item.price * item.qty;
    cartItems.innerHTML += `<li>${item.name} - ${item.price}$ x ${item.qty} <button onclick="removeFromCart(${i})">X</button></li>`;
  });
  totalText.textContent = `ุงููุฌููุน: ${total}$`;
  cartCount.textContent = cart.length;

  const message = cart.map(p => `${p.name} - ${p.price}$ x ${p.qty}`).join("%0A");
  whatsappBtn.href = `https://wa.me/000000000?text=${message}%0Aุงููุฌููุน:${total}$`;
}

// ุชุดุบูู ุนูุฏ ุงูุชุญููู
renderProducts();
renderCart();
renderAdminProducts();

</script>
<script src="style.css"></script>
</body>
</html>
